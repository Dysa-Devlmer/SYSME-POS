<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SYSME 2.0 - POS Demo</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1rem;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .main-container {
            display: flex;
            flex: 1;
            gap: 1rem;
            padding: 1rem;
        }
        .left-panel {
            flex: 1;
            background: white;
            border-radius: 10px;
            padding: 1rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .right-panel {
            width: 400px;
            background: white;
            border-radius: 10px;
            padding: 1rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .section {
            margin-bottom: 2rem;
        }
        .section h3 {
            color: #333;
            margin-bottom: 1rem;
            border-bottom: 2px solid #667eea;
            padding-bottom: 0.5rem;
        }
        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            margin: 0.5rem;
            transition: all 0.3s;
        }
        .btn:hover { background: #5a67d8; transform: translateY(-2px); }
        .btn-success { background: #28a745; }
        .btn-warning { background: #ffc107; color: #333; }
        .btn-danger { background: #dc3545; }
        .btn-small { padding: 0.5rem 1rem; font-size: 0.9rem; }
        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        .table th, .table td {
            padding: 0.8rem;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        .table th {
            background: #f8f9fa;
            font-weight: bold;
        }
        .status-free { background: #d4edda; color: #155724; }
        .status-occupied { background: #f8d7da; color: #721c24; }
        .status-reserved { background: #fff3cd; color: #856404; }
        .form-group {
            margin-bottom: 1rem;
        }
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold;
        }
        .form-group select, .form-group input {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }
        .result {
            background: #f8f9fa;
            border-radius: 5px;
            padding: 1rem;
            margin-top: 1rem;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üçΩÔ∏è SYSME 2.0 - POS Demo Completo</h1>
        <p>Sistema de Punto de Venta - Demostraci√≥n de Funcionalidades</p>
    </div>

    <div class="main-container">
        <div class="left-panel">
            <!-- Login Section -->
            <div class="section">
                <h3>üîê Login de Empleados</h3>
                <div class="form-group">
                    <label>Empleado:</label>
                    <select id="employeeSelect">
                        <option value="">Seleccionar empleado...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>PIN:</label>
                    <input type="password" id="pinInput" placeholder="Ingresa PIN de 4 d√≠gitos" maxlength="4">
                </div>
                <button class="btn" onclick="loginEmployee()">üöÄ Iniciar Sesi√≥n</button>
                <button class="btn btn-warning" onclick="loadEmployees()">üîÑ Cargar Empleados</button>
            </div>

            <!-- Tables Section -->
            <div class="section">
                <h3>üè¢ Gesti√≥n de Mesas</h3>
                <button class="btn" onclick="loadTables()">üìã Cargar Mesas</button>
                <button class="btn" onclick="loadSalons()">üè† Ver Salones</button>
                <button class="btn" onclick="loadTarifas()">üí∞ Ver Tarifas</button>
                <div id="tablesContainer"></div>
            </div>

            <!-- Kitchen Section -->
            <div class="section">
                <h3>üë®‚Äçüç≥ Panel de Cocina</h3>
                <button class="btn" onclick="loadKitchenOrders()">üç≥ √ìrdenes de Cocina</button>
                <button class="btn" onclick="loadKitchenStats()">üìä Estad√≠sticas</button>
                <div id="kitchenContainer"></div>
            </div>
        </div>

        <div class="right-panel">
            <div class="section">
                <h3>üì° Estado del Sistema</h3>
                <p><strong>Backend:</strong> <span id="backendStatus">‚è≥ Verificando...</span></p>
                <p><strong>Token:</strong> <span id="tokenStatus">‚ùå No autenticado</span></p>
                <button class="btn btn-small" onclick="testConnection()">üîç Probar Conexi√≥n</button>
            </div>

            <div class="section">
                <h3>üìã Resultados</h3>
                <div id="results" class="result">Bienvenido al Sistema SYSME 2.0 POS Demo

üéØ Funcionalidades disponibles:
- Login de empleados con PIN
- Gesti√≥n de mesas y salones
- Sistema de tarifas din√°micas
- Panel de cocina en tiempo real
- APIs completas funcionando

üëÜ Usa los botones de la izquierda para probar cada funcionalidad.
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:3001/api/v1';
        let authToken = null;
        let currentUser = null;

        // Utility functions
        function showResult(message, type = 'info') {
            const results = document.getElementById('results');
            const timestamp = new Date().toLocaleTimeString();
            const typeEmoji = type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : '‚ÑπÔ∏è';
            results.innerHTML = `[${timestamp}] ${typeEmoji} ${message}\n\n${results.innerHTML}`;
        }

        function showLoading(elementId) {
            document.getElementById(elementId).innerHTML = '<div class="loading"></div> Cargando...';
        }

        async function apiRequest(endpoint, options = {}) {
            try {
                const config = {
                    ...options,
                    headers: {
                        'Content-Type': 'application/json',
                        ...(authToken && { 'Authorization': `Bearer ${authToken}` }),
                        ...options.headers
                    }
                };

                const response = await fetch(`${API_URL}${endpoint}`, config);
                const data = await response.json();

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${data.error || 'Error desconocido'}`);
                }

                return data;
            } catch (error) {
                showResult(`Error en ${endpoint}: ${error.message}`, 'error');
                throw error;
            }
        }

        // Test connection
        async function testConnection() {
            try {
                const response = await fetch('http://localhost:3001/health');
                const data = await response.json();
                document.getElementById('backendStatus').innerHTML = '‚úÖ Conectado';
                showResult(`Backend conectado exitosamente!\n${JSON.stringify(data, null, 2)}`, 'success');
            } catch (error) {
                document.getElementById('backendStatus').innerHTML = '‚ùå Desconectado';
                showResult(`Error de conexi√≥n: ${error.message}`, 'error');
            }
        }

        // Load employees
        async function loadEmployees() {
            try {
                showResult('üîÑ Cargando empleados...');
                const data = await apiRequest('/auth/pos/employees');

                const select = document.getElementById('employeeSelect');
                select.innerHTML = '<option value="">Seleccionar empleado...</option>';

                data.employees.forEach(emp => {
                    const option = document.createElement('option');
                    option.value = emp.id;
                    option.textContent = `${emp.name} (${emp.role})`;
                    select.appendChild(option);
                });

                showResult(`‚úÖ ${data.employees.length} empleados cargados:\n${JSON.stringify(data.employees, null, 2)}`, 'success');
            } catch (error) {
                showResult(`‚ùå Error cargando empleados: ${error.message}`, 'error');
            }
        }

        // Login employee
        async function loginEmployee() {
            const employeeId = document.getElementById('employeeSelect').value;
            const pin = document.getElementById('pinInput').value;

            if (!employeeId || !pin) {
                showResult('‚ùå Selecciona un empleado e ingresa el PIN', 'error');
                return;
            }

            try {
                showResult('üîÑ Iniciando sesi√≥n...');
                const data = await apiRequest('/auth/pos/login', {
                    method: 'POST',
                    body: JSON.stringify({ employee_id: parseInt(employeeId), pin })
                });

                authToken = data.token;
                currentUser = data.user;

                document.getElementById('tokenStatus').innerHTML = `‚úÖ ${currentUser.name}`;
                document.getElementById('pinInput').value = '';

                showResult(`‚úÖ Login exitoso!\nUsuario: ${currentUser.name}\nRole: ${currentUser.role}\nTPV: ${currentUser.assigned_tpv}`, 'success');
            } catch (error) {
                showResult(`‚ùå Error en login: ${error.message}`, 'error');
            }
        }

        // Load tables
        async function loadTables() {
            try {
                showResult('üîÑ Cargando mesas...');
                const data = await apiRequest('/tables');

                const container = document.getElementById('tablesContainer');
                if (data.tables && data.tables.length > 0) {
                    let html = `<table class="table">
                        <thead>
                            <tr>
                                <th>Mesa</th>
                                <th>Sal√≥n</th>
                                <th>Estado</th>
                                <th>Capacidad</th>
                                <th>Tarifa</th>
                            </tr>
                        </thead>
                        <tbody>`;

                    data.tables.forEach(table => {
                        html += `<tr class="status-${table.status}">
                            <td>${table.table_number}</td>
                            <td>${table.salon_name}</td>
                            <td>${table.status}</td>
                            <td>${table.max_capacity} pax</td>
                            <td>${table.tarifa_name} (${table.tarifa_multiplier}x)</td>
                        </tr>`;
                    });

                    html += '</tbody></table>';
                    container.innerHTML = html;

                    showResult(`‚úÖ ${data.tables.length} mesas cargadas exitosamente`, 'success');
                } else {
                    container.innerHTML = '<p>No hay mesas disponibles</p>';
                    showResult('‚ö†Ô∏è No se encontraron mesas', 'error');
                }
            } catch (error) {
                showResult(`‚ùå Error cargando mesas: ${error.message}`, 'error');
            }
        }

        // Load salons
        async function loadSalons() {
            try {
                showResult('üîÑ Cargando salones...');
                const data = await apiRequest('/tables/salons');
                showResult(`‚úÖ Salones cargados:\n${JSON.stringify(data.salons, null, 2)}`, 'success');
            } catch (error) {
                showResult(`‚ùå Error cargando salones: ${error.message}`, 'error');
            }
        }

        // Load tarifas
        async function loadTarifas() {
            try {
                showResult('üîÑ Cargando tarifas...');
                const data = await apiRequest('/tables/tarifas');
                showResult(`‚úÖ Tarifas cargadas:\n${JSON.stringify(data.tarifas, null, 2)}`, 'success');
            } catch (error) {
                showResult(`‚ùå Error cargando tarifas: ${error.message}`, 'error');
            }
        }

        // Load kitchen orders
        async function loadKitchenOrders() {
            try {
                showResult('üîÑ Cargando √≥rdenes de cocina...');
                const data = await apiRequest('/kitchen/orders');

                const container = document.getElementById('kitchenContainer');
                if (data.orders && data.orders.length > 0) {
                    let html = '<h4>üìã √ìrdenes Activas</h4>';
                    data.orders.forEach(order => {
                        html += `<div style="border: 1px solid #ddd; padding: 1rem; margin: 0.5rem 0; border-radius: 5px;">
                            <strong>Mesa ${order.table_number}</strong> - ${order.status}
                            <br>Tiempo: ${order.created_at}
                        </div>`;
                    });
                    container.innerHTML = html;
                } else {
                    container.innerHTML = '<p>‚úÖ No hay √≥rdenes pendientes en cocina</p>';
                }

                showResult(`‚úÖ √ìrdenes de cocina: ${data.count} activas`, 'success');
            } catch (error) {
                showResult(`‚ùå Error cargando √≥rdenes: ${error.message}`, 'error');
            }
        }

        // Load kitchen stats
        async function loadKitchenStats() {
            try {
                showResult('üîÑ Cargando estad√≠sticas de cocina...');
                const data = await apiRequest('/kitchen/stats');
                showResult(`‚úÖ Estad√≠sticas de cocina:\n${JSON.stringify(data, null, 2)}`, 'success');
            } catch (error) {
                showResult(`‚ùå Error cargando estad√≠sticas: ${error.message}`, 'error');
            }
        }

        // Initialize
        window.onload = function() {
            testConnection();
            loadEmployees();
        };
    </script>
</body>
</html>